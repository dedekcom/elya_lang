
game mg21_duch :Banshee {
	init{
    Banshee::init("mg21_duch");
    .imgs = (A,"bkg.jpg 1","popup_bkg.pyz 2","glow.pyz 3", "hair.pyz 4","rece.pyz 5", "body.pyz 6","lips.pyz 7","eyes.pyz 8", "maska_duch.pyz 9", "szkielko.pyz 10","szkielko_anim.pyz 11", "ramka.pyz 16","popexit.pyz 17", "receptura.pyzH 18");
    .butpopexit;
   // .addtopck("kubek_z_wywarem");
  
    imgbkg {
		.addmethod("isbutin", func { (@x, @y)
			!anpopup_bkg.isin(x,y,0,0) && !anreceptura.isin(x,y,0,0);
			} );
		.addmethod("butclick", func {
			if( !.advstdstate ) return;
			 .mend;
			} );
  		butgame.add(this);
  	};    
      .stdstart; 
      anrece.play(0);
      aneyes.play(0);
      anszkielko_anim.setdrawmode(1); 
      anszkielko_anim.play(0);
      anhair.anopacityframe; 
      anhair.play(0);
      anglow.anopacityframe; 
      anglow.play(0);
     
    if (!clsave.bis("e1_mg21_duch_after_intro") ) {
      .newsnd("snd_intro", "duch_drzewa_c3d3_2");
      snd_intro.addmethod("onfinish", func {.advsetstdstate; 
        anlips.stop(false);
        if (!clsave.bis("e1_mg21_duch_recepta_wzieta"))
        { 
          anreceptura.anfadein(300,null); anreceptura.anfadein(300,null); .show_objective("Ob12"); 
        }
      });
      anlips.play(0);
      .cbplay("snd_intro");
      clsave.bset("e1_mg21_duch_after_intro");
       
    }  
    .newsnd("snd_szkielko", "duch_drzewa_c3d3_3");
    snd_szkielko.addmethod("onfinish", func {.advsetstdstate; anlips.stop(false); });
    
    .newsnd("snd_kubek_oddany", "duch_drzewa_c3d3_22");
     snd_kubek_oddany.addmethod("onfinish", func {.advsetstdstate; anlips.stop(false); });
    
    
    anreceptura{
  			.Button_isin;
  			.addmethod("butmoveon", func {
  				if( !.advstdstate) return;
  				  advmouse.set("take");  
        } );
  			.addmethod("butmoveoff", func {
  				if( !.advstdstate ) return;
  				  advmouse.setstd;
  				} ); 
  			.addmethod("butclick", func {
  		 	    if( !.advstdstate   ) return;
  		 	      .anfadeout(500,null);
              butgame.removebut(this); 
             // .set_mg_finished;
              .timfinito;     
        } );
        butgame.add(this);
		}; 
   
    anszkielko {
  			.addmethod("isbutin", func { (@x, @y)
  			   .advstdstate && .isin(x,y,0,0);
  			} ); 
  			.addmethod("butmoveon", func {
  				if( !.advstdstate ) return;
  				  advmouse.set("take");  
        } );
  			.addmethod("butmoveoff", func {
  				if( !.advstdstate ) return;
  				  advmouse.setstd;
  				} ); 
  			.addmethod("butclick", func {
  		 	    if( !.advstdstate   ) return;
  		 	        if (!clsave.bis("e1_mg21_duch_recepta_wzieta") ) {
                    clsave.bset("e1_mg21_duch_recepta_wzieta");  
                    anreceptura.anfadein(300,null);
                    .show_objective("Ob12");    
                }else if (!clsave.bis("e1_mg21_duch_kubek_oddany") ) 
                { 
                  anlips.play(0);
                  .cbplay("snd_szkielko");
                }
                else
                {
                  //zabieramy szkielko
                }
                
                  
        } );
        butgame.add(this);
		}; 
   
   if (clsave.bis("ma_kubek_z_wywarem"))
   {
      anbody {
  			.addmethod("isbutin", func { (@x, @y)
  			   .advstdstate && .isin(x,y,0,0);
  			} ); 
  			.addmethod("butmoveon", func {
  				if( !.advstdstate ) return;
  				  advmouse.set("use");  
        } );
  			.addmethod("butmoveoff", func {
  				if( !.advstdstate ) return;
  				  advmouse.setstd;
  				} ); 
  			 
        butgame.add(this);
		  }; 
   
   }
   
   
   }// koniec init 
    
  
  mend	{
    .stdexitdefadv("ad21_holglowny", "gamead21_holglowny0"); 
  }
  
  USE_kubek_z_wywarem
  {
  	.advsetstdstate();
    if(anbody.isin(mouse.getpos,0,1) )	{
		 	.removefrompck("kubek_z_wywarem");
		   anlips.play(0);
      .cbplay("snd_kubek_oddany");
      clsave.bset("e1_mg21_duch_kubek_oddany"); 
      advmouse.setstd;
      .objective_done("Ob12"); 
		} else {
			 .item_gotopck;
		}
     
	}    
 
   
   
  HINT_CLICK {
     if (clsave.bis("ma_kubek_z_wywarem"))
     {
        .showhint("anszkielko");
        .showhintitem("kubek_z_wywarem");
     }
     else if(anreceptura.isvisible)
        .showhint("anreceptura");
  
     else
      .showhint("anpopexit");   
  }
}
 
