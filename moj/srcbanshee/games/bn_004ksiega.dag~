
game mg004_ksiega : Banshee	{
	
  
  init	{
		new string act_id = "null";
    Banshee::init("mg004_ksiega");
    
    .askopis("mg004_ksiega");
    
    mus.playstr("crying_loop.ogg -l -v 70");
    .sfxs = (A, "book2", "butmoveon3");
    if(!clsave.bis("e1_kspok_kawalki_zebrane"))
    { 
      .newsndfree("snd_brak_kawalkow", "kinnat_c0d69");
      snd_brak_kawalkow.addmethod("onfinish", "advsetstdstate");
      .cbplay("snd_brak_kawalkow");      
    }
    .imgs = (A, "bkg.jpg 0","popup_bkg.pyz 1", "minigame_mask.pyzH 1", "popexit.pyz 2", "slot1.pyzH 3", "slot2.pyzH 2", "slot3.pyzH 3", "slot4.pyzH 4", "slot5.pyzH 5", "1.pyz 6", "2.pyz 7", "3.pyz 8", "4.pyz 9", "5.pyz 5");  
    .butpopexit; 
   // .addtopck("kawalek_ksiazki_5"); //do testow 
    imgbkg {
		.addmethod("isbutin", func { (@x, @y)
			!anminigame_mask.isin(x,y,0,0);
			} );
		.addmethod("butclick", func {
			if( !.advstdstate ) return;
			 .mend;
			} );
  		butgame.add(this);
  	};      
   
    if (!clsave.bis("e1_kspok_kawalki_uzyte"))  
    {
      for(int i=1;i<6;i++)
          <"an"+i>.hide;  
          
      anminigame_mask { 
        .Button_isinvis;
        .addmethod("butmoveon", func {
  				if( !.advstdstate) return;
  				  if(!clsave.bis("e1_kspok_kawalki_uzyte"))
              advmouse.set("use"); 
               
          } );
  			.addmethod("butmoveoff", func {
  				if( !.advstdstate ) return;
  				  advmouse.setstd;
  				} ); 
          butgame.add(this);
                 
      };
       
    }    
  
    if (clsave.bis("e1_mg004_ksiega_1_inserted") )
    { 
      anslot1.show();
      an1.hide(); 
    }  
    else
      .init_coin("1", 820,502);
       
    if (clsave.bis("e1_mg004_ksiega_2_inserted") )
    { 
      anslot2.show();
      an2.hide(); 
    }  
    else
      .init_coin("2", 780,208); 
      
    if (clsave.bis("e1_mg004_ksiega_3_inserted") )
    { 
      anslot3.show();
      an3.hide(); 
    }  
    else
      .init_coin("3", 920,500);
    
    if (clsave.bis("e1_mg004_ksiega_4_inserted") )
    { 
      anslot4.show();
      an4.hide(); 
    }  
    else
      .init_coin("4", 980,180);
    
    if (clsave.bis("e1_mg004_ksiega_5_inserted") )
    { 
      anslot5.show();
      an5.hide(); 
    }  
    else
      .init_coin("5", 930,350);
     
    .stdstart;
     
  } //koniec init
  
  init_coin(string name, int x,int y)
  {
      <"an"+name>(name, x,y){(string name, int x, int y)
        .setpos(x,y);
        .vars2(A,"name", name, "start_x", x, "start_y", y);
           
        .addmethod("isbutin", func { (@x, @y)
  				 .isin(x,y,1,1);
  				} ); 
        .addmethod("butclick", func {
          if( !.advstdstate || .is_mg_finished()) return;
          if(!clsave.bis("e1_kspok_kawalki_zebrane"))
          { 
            .cbplay("snd_brak_kawalkow"); 
            return;
          }
          
          if (act_id == "null")
          {
            act_id = this;
            fxbutmoveon3.play;
            .setz(300);
          }
          else if(act_id == this)
          { 
            @slot = "anslot"+.name;
            if (<slot>.isin(mouse.getpos,0,1))
            {
              <slot>.show();
              fxbook2.play;
              clsave.bset("e1_mg004_ksiega_"+.name+"_inserted" );
              .hide();
              .check_won();     
            }
            else
            { 
              .setpos(.start_x,.start_y) ; 
              fxbook2.play;
              .setz(2); 
            }
            act_id = "null";
          }
          butgame.sort; 
          .advsetstdstate;
        } );
        butgame.add(this);
      };
  }
  
  check_all_done()
  {
    for(int i=1;i<6;i++)
    {
      if (<"an"+i>.isvisible)
        return false;
    }  
    return true;
  }
  
  check_won()
  {
    if (.check_all_done())
    {
      .set_mg_finished();
      sgmstate = "gotochapter1";
      mus.fadeout(300);
      .timplay("timend", 500, "start_film" );
        
    }
  }
  
  start_film{
    .watch_film("cs02_kinnatbook", "-adv", "ad00_endintro");
  }
  
  mouse_move	{
	  if (act_id != "null")
        <act_id>.setpos(mouse.getpos);
	}
  
  go_to_next_location{
    .stdexitadvadv("ad00_endintro", "gamead00_endintro0"); 
  }
  
  USE_kawalek_ksiazki_5	{
		.advsetstdstate();
    if(anminigame_mask.isin(mouse.getpos,0,1) )	{
		 	.removefrompck("kawalek_ksiazki_5");
		   for(int i=1;i<6;i++)
          <"an"+i>.hide;  
      .timplay("time_show_parts",0, func {
			   for(int i=1;i<6;i++)
            <"an"+i>.anfadein(100 *i,null);  
        });
       fxbook2.play;
      advmouse.setstd;
      clsave.bset("e1_kspok_kawalki_uzyte");
       
		} else {
			 .item_gotopck;
		}
     
	}   
  
  mend	{ 
	mus.fadeout(900);
    .stdexitadvadv("ad004_kspok", "gamead004_kspok0");   
	}
	
	HINT_CLICK {
		if(!clsave.bis("e1_kspok_kawalki_zebrane"))	{
			.showhint("anpopexit");
		} else if( !clsave.bis("e1_kspok_kawalki_uzyte") )	{
			.showhintitem("kawalek_ksiazki_5"); 
			.showhint("anminigame_mask");
		} else if (!clsave.bis("e1_mg004_ksiega_1_inserted") )	{
			.showhint("an1");
			.showhint("anslot1");
		} else if (!clsave.bis("e1_mg004_ksiega_2_inserted") )	{
			.showhint("an2");
			.showhint("anslot2");
		} else if (!clsave.bis("e1_mg004_ksiega_3_inserted") )	{
			.showhint("an3");
			.showhint("anslot3");
		} else if (!clsave.bis("e1_mg004_ksiega_4_inserted") )	{
			.showhint("an4");
			.showhint("anslot4");
		} else if (!clsave.bis("e1_mg004_ksiega_5_inserted") )	{
			.showhint("an5");
			.showhint("anslot5");
		}
	}
}
