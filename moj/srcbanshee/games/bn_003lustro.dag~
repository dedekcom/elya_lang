
game mg003_lustro : Banshee	{
	init	{
		Banshee::init("mg003_lustro");
		.imgs = (A, "bkg.jpg 1", "popup_bkg.pyz 2","anim.pyzH 3","blysk.pyzH 4", "popup_maska.pyz 10", "popup_ramka.pyz 11", "spinka.pyzH 12", "popexit.pyz 13");  
  /*  if (!clsave.bis("e1_mg003_szmata_added"))
     { 
        .addtopck("szmata"); //do testow 
        clsave.bset("e1_mg003_szmata_added");
      }  */ 
    anblysk.setdrawmode(1);
    .setasitemtopck("anspinka");   
    .butpopexit;
		.stdstart;
		
	.sfxs =(A, "skrzypienie_podlogiN 15", "wiatr_w_jaskiniN 50", "przetrzyj", "founditem1 30");
    anpopup_bkg {
  			.Button_isin;
  			.addmethod("butmoveon", func {
  				if( !.advstdstate) return;
  				   if (!clsave.bis("e1_mg003_lustro_szmata_used"))
                advmouse.set("use");  
             else if (!clsave.bis("e1_mg003_lustro_szmata_anim_shown"))
                advmouse.set("take");
             else
                advmouse.setstd;
          } );
  			.addmethod("butmoveoff", func {
  				if( !.advstdstate ) return;
  				  advmouse.setstd;
  				} ); 
  			.addmethod("butclick", func {
  		 	    if( !.advstdstate ||.isvisible_itempopup("spinka")|| ananim.isplaying(-1) ) return;
  		 	    if (clsave.bis("e1_mg003_lustro_szmata_used"))
            {
              advmouse.setstd;
              sgmstate = "lustro_anim" ;
              ananim.play(1); 
              clsave.bset("e1_mg003_lustro_szmata_anim_shown") ; 
              .butdisable;
            }
        } );
        butgame.add(this);
		};
    imgbkg {
		.Button_isinalpha;
		.addmethod("butclick", func {
			if( !.advstdstate ||.isvisible_itempopup("spinka")|| ananim.isplaying(-1) ) return;
			.mend;
			} );
  		butgame.add(this);
  	};   
    
    ananim.addmethod("onfinish", func {
  		if (!.isvisible_itempopup("spinka") )
        { 
          .advsetstdstate;
          .popitem_gotocenterobj("spinka", "anspinka");
        }
         
    } ); 
    
    if (clsave.bis("e1_mg003_lustro_szmata_used"))
    {
      ananim.show();
       
      if (clsave.bis("e1_mg003_lustro_szmata_anim_shown") && !clsave.bis("taken_spinka"))
      {
        .popitem_gotocenterobj("spinka", "anspinka");
      }  
    }
    
    if (!clsave.bis("e1_mg003_lustro_szmata_used")) 
    { 
      .newsnd("sndstart", "kinnat_c0d66");
      sndstart.addmethod("onfinish", "advsetstdstate"); 
      .cbplay("sndstart");
       
    }
    
  } //koniec init
  mend	{
    .stdexitdefadv("ad003_ksrod", "gamead003_ksrod0");
	} 
  HINT_CLICK {
    if (!clsave.bis("taken_spinka")&& clsave.bis("taken_szmata") )
    { 
      .showhint("ananim");
      if (!clsave.bis("e1_mg003_lustro_szmata_used"))
      { 
        .showhintitem("szmata");
      } 
    }
    else
      .showhint("anpopexit");
  }
  
  show_blink{
    sgmstate = "blink_anim" ;
    anblysk.anfadein(1000,"hide_blink");   
  }
  
  hide_blink{
    anblysk.anfadeout(1000, "advsetstdstate");  
  }
  
  
  anspinka_INPCK {   
     .addtopck("spinka");  
    .set_mg_finished; 
    .timfinito;
  } 
  
  USE_szmata	{
		.advsetstdstate();
    if(ananim.isin(mouse.getpos,0,0) && !clsave.bis("e1_mg003_lustro_szmata_used") )	{
      .removefrompck("szmata");
      advmouse.set("take");
      ananim.anfadein(1200,"show_blink");
      clsave.bset("e1_mg003_lustro_szmata_used");
         fxprzetrzyj.play;
		} else {
			.advsetstdstate;
			.item_gotopck;
       
        
		}
	}
        
}