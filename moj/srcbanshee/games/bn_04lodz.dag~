
game mg04_lodz :Banshee {
	init{
    Banshee::init("mg04_lodz");
    .imgs = (A, "$scripts/mg04_glowa1/bkg.jpg 1", "base.pyz 2", "krysztal_blue.pyzH 3", "medalion.pyzH 4",  "ramka.pyz 5", "popexit.pyz 6", 
	"medalion_wlozony.pyzH 7",  "kruk_idle.pyzH 8", "flight.pyzH 9", "medalion_w_dziobie.pyzH 10" );
    .butpopexit;
    .butpopexitisinramka;
    
    .sfxs = (A, "bgrmorze3N 70", "ptakout 60", "openwindow", "opendoor2");
    
    if (!clsave.bis("e1_kruk_odlecial"))	{
      ankruk_idle.play("loop");   
      .newsndfree("sndkrukodlecial", "kinnat_28");
      sndkrukodlecial.addmethod("onfinish", func{
		.advsetstdstate;
		<GAME>.show_objective("OB4");
	} );
     }
                                                             
  //  .addtopck("kluczlodz"); 
    
    if (!clsave.bis("taken_krysztal_blue_2"))
    { 
      ankrysztal_blue.show;
      .setasitemtopck("ankrysztal_blue");  
      if (!clsave.bis("e1_kruk_odlecial"))
        ankrysztal_blue.disable = (true); 
      else
         ankrysztal_blue.disable = (false); 
    }  
    
    
    ankruk_idle {
			.Button_isin; 
			.Button_moveonms;
			.Button_moveoffms;
			.addmethod("butclick", func {
			if( !.advstdstate || clsave.bis("e1_kruk_odlecial")) return;
				  .hide();
          clsave.bset("e1_kruk_odlecial");
          ankruk_idle.stop(false);
          fxptakout.play;
          anflight.play(0);
          sgmstate = "state_kruk_odlatuje";
          ankrysztal_blue.disable = (false); 
      } );
			 
			butgame.add(this);
		};
    
    anflight {
      .addmethod("onfinish", func {
			  .hide(); 
			  .cbplay("sndkrukodlecial");
          
      //  .mend();   
				} );
		};   
    
	//.newsndfree("sndlocked", "kinnat_56");
	//anmedalion_wlozony.Button_stdms;
   anmedalion_wlozony.addmethod("butmoveon", func {
    			if( !.advstdstate) return;
    			  if (!clsave.bis("e1_lodz_odblokowana") )
              advmouse.set("use");
            else
              advmouse.setstd;
          } );
  anmedalion_wlozony.addmethod("butmoveoff", func {
    			if( !.advstdstate ) return;
    			  advmouse.setstd;
    			} );
           
	anmedalion_wlozony.addmethod("isbutin", func { (@x, @y) .isin(x,y,0,0); } );
	/*anmedalion_wlozony.addmethod("butclick", func { 
		if( .advstdstate && !clsave.bis("e1_lodz_odblokowana") )
			.crplay("sndlocked");
		} );*/
	butgame.add("anmedalion_wlozony");
	
    if( clsave.is("GAME_sgmlastscene", "gamead04b_lodz0") )	{
	.advsetstdstate;
    } else {
	ccs.enter( func {
		if( !clsave.bis("e1_lodz_1st_click") )	{
			clsave.bset("e1_lodz_1st_click");
			
			/*sndlocked.addmethod("onfinish", func {
				.gotoadv("ad04b_lodz", "gamead04b_lodz0");
				} );
			.cbplay("sndlocked");*/
			.gotoadv("ad04b_lodz", "gamead04b_lodz0");
		} else	{
			anbase.addmethod("onfinish", func {
				.stdexitdefadv("ad05_lodz", "gamead05_lodz0"); 
				} );
			.advsetstdstate;
		}
		} );
	}
    } // koniec init
    
  ankrysztal_blue_TAKE	{.check_finished();	.item_takecenter("krysztal_blue_2");	}
	ankrysztal_blue_INPCK	{
		  .addtopck("krysztal_blue_2");
      if (!clsave.bis("ma_kluczlodz"))
        .timfinito;
	} 
   
  mend	{
    .stdexitdefadv("ad04_brzegjeziora", "gamead04_brzegjeziora0"); 
	}
  
  HINT_CLICK {
    if (!clsave.bis("e1_kruk_odlecial"))
    {
      .showhint("ankruk_idle");
    }
    else if(!clsave.bis("taken_krysztal_blue_2"))
      .showhint("ankrysztal_blue");
    else if(clsave.bis("ma_kluczlodz"))
    {
        .showhintitem("kluczlodz"); 
        .showhint("anmedalion_wlozony");  
    }
    else
      .showhint("anpopexit"); 
  }            
	USE_kluczlodz	{
		if( anmedalion_wlozony.isin(mouse.getpos,0,0) )	{
			clsave.bset("e1_lodz_odblokowana");
			butgame.removebut("anmedalion_wlozony");
			butgame.onmousemove;
			.removefrompck("kluczlodz");
			sgmstate = "state_openlodz";
			anbase.playsmooth("open");
			fxopenwindow.play;
			fxopendoor2.play;
			anmedalion_wlozony.playsmooth("open");
		} else {
			.advsetstdstate;
			.item_gotopck;
		}
	}
}
 
